import os
import torch

# 牛脸识别模型配置文件
# 本文件包含模型训练和推理所需的所有配置参数，统一管理便于修改和维护

# 直接定义配置字典 - 包含数据、模型、训练等各方面的配置
config = {
    # 数据相关配置
    'data': {
        # 训练批次大小 - 每个训练批次包含的样本数量
        # 增大可提高训练效率，但会增加内存占用；减小可降低内存使用
        'batch_size': 16,
        # 输入图像尺寸 - 模型处理的图像大小
        # 牛脸图像会被调整为224x224像素
        'image_size': 224,
        # 数据加载线程数 - 用于并行加载数据的工作线程数
        # 根据CPU核心数量调整，一般设置为CPU核心数或稍低
        'num_workers': 6,
        # 训练数据目录 - 存放训练图像的文件夹路径
        'train_dir': '/root/autodl-fs/cowface/dataset/train',
        # 测试数据目录 - 存放测试图像的文件夹路径
        'test_dir': '/root/autodl-fs/cowface/dataset/test'
    },
    
    # 模型相关配置
    'model': {
        # 主干网络类型 - 特征提取网络的名称
        # 目前支持'resnet50'，可根据需要扩展其他骨干网络
        'backbone': 'resnet50',
        # 嵌入向量维度 - 最终输出的特征向量维度
        # 512维特征向量在保留足够信息的同时保持计算效率
        'embedding_size': 512
    },
    
    # 训练相关配置
    'train': {
        # 训练轮数 - 整个数据集训练的次数
        # 30轮在大多数情况下能平衡训练充分性和训练时间
        'epochs': 35,
        # 学习率 - 优化器的初始学习率
        # 0.001是Adam优化器的常用起始学习率
        'lr': 0.001,
        # 权重衰减 - L2正则化系数，用于防止过拟合
        # 0.0005是较小的权重衰减，可抑制过拟合同时不过度限制模型容量
        'weight_decay': 0.0005,
        # 三元组损失的间隔参数 - 控制正负样本对的分离程度
        # 0.3的间隔值在人脸识别任务中表现良好
        'margin': 0.3,
        # 是否使用难例挖掘 - 控制是否启用难三元组挖掘策略
        # 启用难例挖掘通常能提高模型性能，但会增加计算量
        'hard_mining': True,
        # 难例挖掘时的嵌入计算批次大小 - 用于特征提取的批次大小
        # 该批次大小通常小于常规训练的批次大小，以减少内存使用
        'hard_embedding_batch_size': 16,
        # 难三元组训练批次大小 - 训练难例时的批次大小
        # 较大的批次大小可以提供更多样的难例训练
        'hard_train_batch_size': 16,
        # 最小难三元组数量 - 当没有有效难三元组时返回的最小数量
        # 确保即使没有难例也能返回足够的训练样本
        'min_hard_triplets': 32
    },
    
    # 硬件配置
    # 自动检测是否使用GPU - 使用PyTorch内置的CUDA检测功能
    # 适用于Windows、Linux和macOS等各种操作系统
    'device': 'cuda' if torch.cuda.is_available() else 'cpu',
    
    # 随机种子 - 用于复现实验结果
    # 设置固定种子可确保在不同运行中得到相同的随机初始化
    'seed': 42
}

# 定义一个加载配置的函数，直接返回上面定义的config字典
def load_config():
    """直接返回预定义的配置字典
    
    Returns:
        dict: 包含所有配置参数的字典
    """
    return config